stages:
  - name: check configuration
    if: branch = deploy
  - name: deploy
    if: tag =~ /^v[0-9]+\.[0-9]+\.[0-9]+$/ AND branch = master

jobs:
  include:
    - stage: check configuration
      before_script: ./package/prepare.sh
      script: ./package/test.sh
    - stage: deploy
      before_script: ./package/prepare.sh
      script: ./package/deploy.sh
